<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Alpine.js Debug Test - HD Tickets</title>
    
    <!-- Load CSS from built assets -->
    <link rel="stylesheet" href="/build/assets/css/app-BeZov68Y.css">
    
    <style>
        [x-cloak] { display: none !important; }
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .dropdown {
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin-top: 5px;
            position: absolute;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 200px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .btn:hover {
            background: #0056b3;
        }
        nav {
            background: #f8f9fa;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        .relative { position: relative; }
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <h1>HD Tickets Alpine.js Debug Test</h1>
        
        <!-- Status Display -->
        <div class="debug-section">
            <h2>üîç Debug Status</h2>
            <div id="status-display">
                <p>üïí Loading systems...</p>
            </div>
        </div>

        <!-- Console Output -->
        <div class="debug-section">
            <h2>üìú Console Output</h2>
            <div id="console-output" class="console-output">
                [Loading...]
            </div>
        </div>

        <!-- Test 1: Basic Alpine.js functionality -->
        <div class="debug-section" x-data="{ message: 'Alpine.js is working!', count: 0, visible: true }">
            <h3>üß™ Test 1: Basic Alpine.js</h3>
            <div x-show="visible">
                <p x-text="message"></p>
                <button class="btn" @click="count++">Count: <span x-text="count"></span></button>
                <button class="btn" @click="visible = false">Hide This Section</button>
            </div>
            <button x-show="!visible" class="btn" @click="visible = true">Show Section</button>
        </div>

        <!-- Test 2: Navigation Data Function Test -->
        <div class="debug-section relative" x-data="navigationDataTest()">
            <h3>üß™ Test 2: navigationData() Function</h3>
            <button class="btn" @click="adminDropdownOpen = !adminDropdownOpen">
                Admin Menu (<span x-text="adminDropdownOpen ? 'Open' : 'Closed'"></span>)
            </button>
            <div x-show="adminDropdownOpen" x-cloak class="dropdown">
                <p>Admin dropdown is working!</p>
                <button class="btn" @click="adminDropdownOpen = false">Close</button>
            </div>
            
            <button class="btn" @click="profileDropdownOpen = !profileDropdownOpen">
                Profile Menu (<span x-text="profileDropdownOpen ? 'Open' : 'Closed'"></span>)
            </button>
            <div x-show="profileDropdownOpen" x-cloak class="dropdown">
                <p>Profile dropdown is working!</p>
                <button class="btn" @click="profileDropdownOpen = false">Close</button>
            </div>
            
            <br><br>
            <button class="btn" @click="closeAll()">Close All Dropdowns</button>
        </div>

        <!-- Test 3: x-cloak functionality -->
        <div class="debug-section" x-data="{ showContent: false }">
            <h3>üß™ Test 3: x-cloak Functionality</h3>
            <button class="btn" @click="showContent = !showContent">Toggle Content</button>
            <div x-show="showContent" x-cloak style="background: #e8f5e8; padding: 1rem; margin-top: 1rem;">
                <p>This content should not flash when Alpine loads (x-cloak working)</p>
            </div>
        </div>

        <!-- Test 4: Event handlers -->
        <div class="debug-section" x-data="{ logs: [] }">
            <h3>üß™ Test 4: Event Handlers (@click, x-on)</h3>
            <button class="btn" @click="logs.push('Click event at ' + new Date().toLocaleTimeString())">Add Log Entry</button>
            <button class="btn" x-on:click="logs = []">Clear Logs</button>
            <div style="margin-top: 1rem;">
                <template x-for="(log, index) in logs" :key="index">
                    <div x-text="log" style="background: #fff3cd; padding: 0.25rem; margin: 0.25rem 0;"></div>
                </template>
            </div>
        </div>
    </div>

    <!-- Load built JavaScript assets -->
    <script type="module" src="/build/assets/js/app-DiF5Oeeo.js"></script>

    <script>
        // Console capture and display
        let consoleOutput = document.getElementById('console-output');
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        let originalConsoleWarn = console.warn;

        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#feca57' : '#00ff00';
            consoleOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(message) {
            addToConsole(message, 'log');
            originalConsoleLog.apply(console, arguments);
        };

        console.error = function(message) {
            addToConsole(message, 'error');
            originalConsoleError.apply(console, arguments);
        };

        console.warn = function(message) {
            addToConsole(message, 'warn');
            originalConsoleWarn.apply(console, arguments);
        };

        // Test function that mimics navigationData
        function navigationDataTest() {
            console.log('navigationDataTest function called');
            return {
                open: false,
                mobileMenuOpen: false,
                adminDropdownOpen: false,
                profileDropdownOpen: false,
                
                init() {
                    console.log('navigationDataTest component initialized');
                    document.addEventListener('click', (e) => {
                        if (!this.$el.contains(e.target)) {
                            this.adminDropdownOpen = false;
                            this.profileDropdownOpen = false;
                        }
                    });
                },
                
                closeAll() {
                    console.log('closeAll called');
                    this.adminDropdownOpen = false;
                    this.profileDropdownOpen = false;
                    this.mobileMenuOpen = false;
                }
            };
        }

        // Status check function
        function checkStatus() {
            const statusDisplay = document.getElementById('status-display');
            let status = '<div>';

            // Check Alpine.js
            if (window.Alpine) {
                status += '<p class="success">‚úÖ Alpine.js loaded successfully</p>';
                status += `<p class="success">   Version: ${Alpine.version || 'unknown'}</p>`;
                console.log('Alpine.js available:', Alpine);
            } else {
                status += '<p class="error">‚ùå Alpine.js not loaded</p>';
                console.error('Alpine.js not available');
            }

            // Check if navigationData is available
            if (typeof window.navigationData === 'function') {
                status += '<p class="success">‚úÖ navigationData function available globally</p>';
            } else {
                status += '<p class="warning">‚ö†Ô∏è navigationData function not in global scope (this is normal - it\'s registered as Alpine.data)</p>';
                
                // Check if it's registered with Alpine
                if (window.Alpine && window.Alpine.__x && window.Alpine.__x.datas && window.Alpine.__x.datas.navigationData) {
                    status += '<p class="success">‚úÖ navigationData registered as Alpine.data component</p>';
                } else if (window.Alpine && window.Alpine.data) {
                    // Try alternative way to check if data is registered
                    status += '<p class="success">‚úÖ Alpine.data available (navigationData likely registered)</p>';
                } else {
                    status += '<p class="error">‚ùå navigationData not registered with Alpine.data</p>';
                }
            }

            // Check x-cloak styles
            const xCloakStyle = Array.from(document.styleSheets).some(sheet => {
                try {
                    return Array.from(sheet.cssRules).some(rule => rule.selectorText && rule.selectorText.includes('[x-cloak]'));
                } catch(e) { return false; }
            });
            
            if (xCloakStyle) {
                status += '<p class="success">‚úÖ x-cloak styles found</p>';
            } else {
                status += '<p class="warning">‚ö†Ô∏è x-cloak styles may be missing</p>';
            }

            // Check if modules loaded
            if (window.AppCore) {
                status += '<p class="success">‚úÖ AppCore available</p>';
            } else {
                status += '<p class="warning">‚ö†Ô∏è AppCore not available</p>';
            }

            status += '</div>';
            statusDisplay.innerHTML = status;
        }

        // Run checks when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Check status immediately and after a delay
            checkStatus();
            setTimeout(checkStatus, 1000);
            setTimeout(checkStatus, 3000);
        });

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.message, 'at', e.filename + ':' + e.lineno);
        });

        // Alpine.js specific error handling
        document.addEventListener('alpine:init', () => {
            console.log('Alpine.js initialization started');
        });

        document.addEventListener('alpine:initialized', () => {
            console.log('Alpine.js fully initialized');
            checkStatus();
        });
    </script>
</body>
</html>
