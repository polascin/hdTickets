# HD Tickets Automated Tasks
# Sports Events Entry Tickets Monitoring System - Scheduled Jobs

# Certificate Renewal - Check twice daily at 3:30 AM and 3:30 PM
# This ensures certificates are renewed well before expiry
30 3,15 * * * /var/www/hdtickets/renew-certificates.sh >> /var/log/hdtickets-cron.log 2>&1

# Certificate Monitoring - Check certificate status daily at 8:00 AM
0 8 * * * /var/www/hdtickets/ssl-status.sh >> /var/log/hdtickets-ssl-status.log 2>&1

# Let's Encrypt built-in renewal check - Run twice daily (backup)
# This provides redundancy in case our custom script fails
0 1,13 * * * /usr/bin/certbot renew --quiet --no-self-upgrade >> /var/log/letsencrypt/renew.log 2>&1

# Apache log rotation trigger (weekly on Sunday at 2:00 AM)
0 2 * * 0 /usr/sbin/logrotate /etc/logrotate.d/apache2

# Security log analysis (daily at 9:00 AM)
0 9 * * * /bin/bash -c 'if [ -f /var/www/hdtickets/analyze-security-logs.sh ]; then /var/www/hdtickets/analyze-security-logs.sh; fi' >> /var/log/hdtickets-security-analysis.log 2>&1

# Disk space monitoring for SSL logs (daily at 7:00 AM)
0 7 * * * /bin/bash -c 'df -h /var/log | tail -1 | awk "{print \$5}" | sed "s/%//" | awk "{if (\$1 > 80) print \"WARNING: Log disk usage at \" \$1 \"%\"}" | logger -t hdtickets-disk-monitor

# SSL certificate expiry alerts (weekly on Monday at 10:00 AM)
0 10 * * 1 /var/www/hdtickets/check-cert-expiry.sh >> /var/log/hdtickets-cert-expiry.log 2>&1

# Cleanup old backup files (monthly on 1st day at 4:00 AM)
# Keep only last 3 months of SSL backups
0 4 1 * * find /var/backups/ssl-* -type d -mtime +90 -exec rm -rf {} \; 2>/dev/null

# Performance monitoring and optimization check (daily at 11:00 PM)
0 23 * * * /bin/bash -c 'if [ -f /var/www/hdtickets/performance-monitor.sh ]; then /var/www/hdtickets/performance-monitor.sh; fi' >> /var/log/hdtickets-performance.log 2>&1
